#!/usr/bin/env python3

import argparse
import socket
import ssl

DEFAULT_SERVER = "proj5.3700.network"
DEFAULT_PORT = 443

class Crawler:
    def __init__(self, args):
        self.server = args.server
        self.port = args.port
        self.username = args.username
        self.password = args.password



    # Get 
    # Post to login

    def run(self):
        #Accept-Encoding: gzip, deflate
        request = "GET https://proj5.3700.network/fakebook/ HTTP/1.1\r\nHost: " + DEFAULT_SERVER + "\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE5.01; Windows NT)\r\n" + "Accept-Language: en-us\r\n" + "Accept-Encoding: gzip, deflate" + "\r\n\r\n"


        # conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        # tls_context = ssl.create_default_context()
        # conn = tls_context.wrap_socket(conn, server_hostname=args.hostname)
        # conn.connect((args.hostname, args.port))




        print("Request to %s:%d" % (self.server, self.port))
        print(request)
        mysocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        ssl_context = ssl.create_default_context()
        mysocket = ssl_context.wrap_socket(mysocket, server_hostname=DEFAULT_SERVER)
        mysocket.connect((self.server, self.port))
        mysocket.send(request.encode('ascii'))

        data = mysocket.recv(1000)
        # print("data???")
        # print(data)
        print("Response:\n%s" % data.decode('ascii'))

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='crawl Fakebook')
    parser.add_argument('-s', dest="server", type=str, default=DEFAULT_SERVER, help="The server to crawl")
    parser.add_argument('-p', dest="port", type=int, default=DEFAULT_PORT, help="The port to use")
    parser.add_argument('username', type=str, help="The username to use")
    parser.add_argument('password', type=str, help="The password to use")
    args = parser.parse_args()
    sender = Crawler(args)
    sender.run()
